<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, proxy-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Student Dashboard</title>
  <!-- Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  
  <style>
    .navbar-nav {
      margin: auto;
    }
  
    .modal-header-content {
      text-align: center;
      margin-bottom: 20px;
    }
  
    .modal-header-content img {
      max-width: 80px; /* Adjust logo width */
      display: block;
      margin: 0 auto;
    }
  
    .modal-title {
      margin-bottom: 0;
      text-align: center; /* Center align modal title */
    }
  
    .modal-footer {
      justify-content: center;
    }
  
    .signature {
      margin-top: 20px;
    }
  
    .profile-picture-container {
      max-width: 200px; /* Adjust width as needed */
      max-height: 300px; /* Adjust height as needed */
      margin: 0 auto; /* Center the container */
      overflow: hidden; /* Ensure the image doesn't overflow */
      border-radius: 10px; /* Rounded corners for the picture */
    }
  
    .profile-picture {
      width: 80%; /* Ensure the picture fills the container */
      height: auto; /* Maintain aspect ratio */
      display: block; /* Center the image within its container */
      margin: 0 auto;
    }
  
    .card {
      border-radius: 20px; /* Rounded corners for the card */
      overflow: hidden;
    }
  
    .profile-card {
      max-width: 550px; /* Increase the width for profile card */
      margin: 0 auto; /* Centered content */
      height:400px;
    }
  
    .card-body {
      padding: 1.25rem; /* Padding inside the card body */
    }
  
    .card-title {
      font-weight: bold;
    }
  
    /* styles for ID card modal */
    .id-card {
      text-align: center;
      padding: 1.25rem;
      border: 2px solid #000; /* Border around the card */
      max-width: 300px; /* Portrait orientation */
      margin: 0 auto; /* Centered content */
      margin-bottom: 20px; /* Space below the card */
    }
    
    .id-card-back {
      /* Additional styles for back of ID card */
      text-align: center; /* Center content */
      padding: 1.25rem; /* Padding */
      border: 2px solid #000; /* Border around the card */
      max-width: 300px; /* Portrait orientation */
      margin: 0 auto; /* Centered content */
    }
  
    .id-card-logo {
      max-width: 80px;
      margin: 0 auto;
      display: block;
    }
  </style>
  <script>
    window.onload = function() {
        // Prevent back button after logout
        if (!window.performance || window.performance.navigation.type === 2) {
            window.location.href = '/login';
        }
    };

    // Check session expiration periodically
    setInterval(function() {
        fetch('/checkSession')
            .then(response => response.json())
            .then(data => {
                if (!data.loggedIn) {
                    alert('Session expired. Please log in again.');
                    window.location.href = '/login';
                }
            });
    }, 5 * 60 * 1000); // Check every 5 minutes
  </script>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand ml-5 pl-5" href="#">
      <img src="logo.jpg" alt="CompuTech Nexus Academy Logo" height="30" class="mr-2"> Student Dashboard
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ml-auto">
        <!-- Tasks dropdown -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle ml-5" href="#" id="navbarDropdownTasks" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Tasks </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdownTasks">
            <a class="dropdown-item" href="#">Take Exams</a>
            <a class="dropdown-item" href="#">Take Test</a>
            <a class="dropdown-item" href="#" id="viewIDCard">View ID Card</a>
          </div>
        </li>
        <!-- Result dropdown -->
        <li class="nav-item dropdown"> 
          <a class="nav-link dropdown-toggle ml-5" href="#" id="navbarDropdownResults" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Result
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdownResults">
            <a class="dropdown-item" href="#">CA Result</a>
            <a class="dropdown-item" href="#">Exam Result</a>
          </div>
        </li>
        <!-- Logout button -->
        <li class="nav-item"> 
          <a class="nav-link ml-5" href="#" id="logout">Logout</a>
        </li>
      </ul>
    </div>
  </nav>

  <section><!-- Student Profile -->
    <div class="container mt-4">
      <div class="card profile-card">
        <div class="card-header text-center">
          CompuTech Nexus Academy
        </div>
        <div class="card-body text-center">
          <div class="profile-picture-container">
            <img src="" id="profile-pic" class="profile-picture" alt="Profile Picture">
          </div>
          <h5 class="card-title mt-3" id="studentName"></h5>
          <p class="card-text">Admission Number: <span id="admissionNumber"></span></p>
          <p class="card-text">Course of Study: <span id="courseApplied"></span></p>
          <p class="card-text">Email: <span id="emailAddress"></span></p>
          <div class="signature"></div>
        </div>
      </div>
    </div>
  </section><!-- End of Student Profile -->
  

  <!-- Modal for ID Card -->
  <div class="modal fade" id="idCardModal" tabindex="-1" role="dialog" aria-labelledby="idCardModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
      <div class="modal-content">
        <div class="modal-header">
         
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <!-- Front of ID Card -->
          <div class="id-card">
            <div class="modal-header-content">
              <img src="logo.jpg" alt="School Logo" class="id-card-logo">
              <h5 class="modal-title">CompuTech Nexus Academy</h5>
              <h6 class="modal-title">Student ID Card</h6>
            </div>
            <img src="" id="modalProfilePic" style="max-width: 150px; max-height: 150px;" alt="Profile Picture">
            <h5 class="card-title mt-3" id="modalStudentName"></h5>
            <p class="card-text">Admission Number: <span id="modalAdmissionNumber"></span></p>
            <p class="card-text">Course of Study: <span id="modalCourseApplied"></span></p>
            <p class="card-text">Email: <span id="modalEmailAddress"></span></p>
            <div class="signature">
              <p>Signature: ________________________</p>
            </div>
          </div>
          
          <!-- Back of ID Card -->
          <div class="id-card-back">
            <h5>Usage Policy</h5>
            <p>This ID card is issued to the bearer as a means of identification at CompuTech Nexus Academy. It remains the property of the academy and must be surrendered upon request. It is non-transferable and is to be used solely by the person to whom it is issued. For security reasons, the card must be signed immediately upon receipt. If found, please return it to:</p>
            <p>CompuTech Nexus Academy, 32 Km, Maiduguri Road, Gano 2 Primary School, Dawakin Kudu L.G.A</p>
            <p>Contact Numbers: 08030909793, 08033643018, 09123754300</p>
            <p>Email: <a href="mailto:1440shamsusabo@gmail.com">1440shamsusabo@gmail.com</a></p>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="window.print()">Print</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS, Popper.js, and jQuery -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const admissionNumber = "your_admission_number"; // Replace with actual admission number after login

      // Function to fetch and populate student details
      function fetchStudentDetails() {
        $.ajax({
          url: '/populateStudentDetails',
          type: 'GET',
          data: { admissionNumber: admissionNumber },
          success: function (response) {
            let studentName = response.firstName + ' ' + response.surname;
            if (response.lastName) {
              studentName += ' ' + response.lastName;
            }
            $('#studentName').text(studentName);
            $('#admissionNumber').text(response.admissionNumber);
            $('#courseApplied').text(response.courseApplied);
            $('#emailAddress').text(response.emailAddress);
            $('#modalStudentName').text(studentName);
            $('#modalAdmissionNumber').text(response.admissionNumber);
            $('#modalCourseApplied').text(response.courseApplied);
            $('#modalEmailAddress').text(response.emailAddress);
            if (response.profile_picture_url) {
              $('#profile-pic').attr('src', response.profile_picture_url);
              $('#modalProfilePic').attr('src', response.profile_picture_url);
            } else {
              $('#profile-pic').attr('src', 'Profile-Black.png'); // Default profile picture if none available
              $('#modalProfilePic').attr('src', 'Profile-Black.png'); // Default profile picture if none available
            }
          },
          error: function (xhr, status, error) {
            console.error('Error fetching student details:', error);
          }
        });
      }

      // Call fetchStudentDetails on page load
      fetchStudentDetails();

      // Event listener for logout
      const logoutLink = document.getElementById("logout");
      logoutLink.addEventListener("click", function (event) {
        event.preventDefault();
        // Perform logout actions here, such as clearing session and redirecting
        $.ajax({
          url: '/logout', // Replace with your logout endpoint
          type: 'POST',
          success: function () {
            window.location.href = "index.html"; // Redirect to login page after logout
          },
          error: function (xhr, status, error) {
            console.error('Error during logout:', error);
          }
        });
      });

      // Event listener for opening ID card modal
      const viewIDCardLink = document.getElementById("viewIDCard");
      viewIDCardLink.addEventListener("click", function (event) {
        event.preventDefault();
        $('#idCardModal').modal('show');
      });
    });
  </script>
</body>
</html>
